<!DOCTYPE html>
<html>
	<title>Emergency Room Simulator</title>
	<link rel = "styleSheet" href = "{{ url_for('static', filename='main.css') }}" type = "text/css" />
<body>
	<nav id = 'topMenu'>
		<ul id = 'menuItems'> 
			<li>
				<a href="#">Patient List</a>
				<ul class = 'patientList'>
					<li>
						<a href="#">Patient 1</a>
					</li>
					<li>
						<a href="#">Patient 2</a>
					</li>
				</ul>
			</li>
			<li>
				<a href="#" id = 'command'>Command</a>
			</li>
			<li>
				<a href="#">Logout</a>
			</li>
		</ul>
	</nav>
	<div class = 'infoPane'>
		<div class = 'info'>
			<textarea readonly id = "infoText"></textarea>
		</div>
		<div class = 'commandBox'>
			<p id = "commandLabel" >Command:</p>
			<input type = "text" name = "command" id = "commandText">
			<input type = "submit" value = "Submit" id = "submitButton">
		</div>
	</div>
	<div class = 'mediaPane' id = 'mediaPane'>
		<h1>Media</h1>
	</div>
	<div class = 'commandList'>
		<h1>Command List (?)</h1>
		<table id="commandListTable" >
			<thead>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
</body>
</html>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script>
	function loadCommandList() {
		$.get("/edit/getTriggerList", 
			function(data,status) { 
				var obj = JSON.parse(data);

				$.each(obj, function(i, item) {
					$('#commandListTable > tbody:last').append("<tr><td>" + item.trigger + "</td></tr>")
				});
			}
		);
	};

	$(function() {$("#commandText").focus();});

	$(document).ready(function() {
		loadCommandList();

		$("#submitButton").click(function() {
			$.post("response", 
				{ trigger:$("#commandText").val(), patientID:getParameterByName("patientID")}, 
				function(data,status) { 
					var obj = JSON.parse(data)

					$("#infoText").val($("#infoText").val() + 
						"> " + $("#commandText").val() +
						"\n" + obj.text + "\n");
					$("#commandText").val("");
					$("#infoText").scrollTop($("#infoText")[0].scrollHeight);

					if (obj.media != "") {
						$("#mediaPane").append('<a href="' + obj.media + '" target="_blank"><img width="150" height="150" border="0" src="' + obj.media + '" /></a><br/>')
					}
				}
			);

		});
	});

	$("#commandText").keyup(function(event) {
		if (event.keyCode == 13) {
			$("#submitButton").click();
		}
	});

	function getParameterByName(name) {
	    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
	    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
	        results = regex.exec(location.search);
	    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
	}
</script>
